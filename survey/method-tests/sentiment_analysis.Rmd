---
title: "Sentiment analysis"
author: "Avner Peled"
date: "5/16/2021"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

```{r , include=FALSE}
library(dplyr)
library(magrittr)
library(knitr)
library(tidytext)
library(textdata)
library(wordcloud)
library(wordcloud2)
library(ggplot2)
#load("/home/avnerus/Code/R/survey/tests.RData")
#knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown analysis

Sentiments for the (translated) question:
_Imagine you would have the opportunity to interact with a robot that is operated by a person in another location. 
How would that compare to meeting a person face-to-face?_

```{r}
sentiments <- Telerobot_sorted %>% 
  select("v","Q_TELEROBOT_VS_F2F_TRANS") %>%
  unnest_tokens(word, "Q_TELEROBOT_VS_F2F_TRANS") %>%
  inner_join(get_sentiments("bing")) %>%
  count(v, sentiment) %>%
  group_by(v)  %>%
  mutate(freq = n / sum(n))

ggplot(sentiments,aes(x=sentiment, y=freq, color=v)) + 
  geom_bar(stat="identity") + 
  facet_wrap(~ v) 

```
  
## Question
Imagine you could operate your telerobot anywhere in the world.
What places would you want to visit with your robot avatar and what kind of activities would you have it perform?

## Word cloud
```{r, fig.width=12,fig.asp=0.5}

df <- Telerobot_ages_filtered %>% 
  dplyr::filter(v == "IL") %>%
  select("Q_TELEROBOT_VS_F2F_TRANS") %>%
  drop_na() 

  df %>%
  unnest_tokens(word, "Q_TELEROBOT_VS_F2F_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(do[es]*n['’]t)|(person)|(robot)|(meeting)|(it['’]s)", .$word)) %>%
  with(wordcloud(word, n, max.words = 100, scale = c(5,1), colors=brewer.pal(8, "Dark2")))
  #arrange(desc(n))


df <- Telerobot_ages_filtered %>% 
  dplyr::filter(v == "PS") %>%
  select("Q_TELEROBOT_VS_F2F_TRANS") %>%
  drop_na()


  df %>%
  unnest_tokens(word, "Q_TELEROBOT_VS_F2F_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(do[es]*n['’]t)|(person)|(robot)|(meeting)", .$word)) %>%
  with(wordcloud(word, n, max.words = 100, scale = c(3.5,.5), colors=brewer.pal(8, "Dark2")))
  #arrange(desc(n))

```
## Word cloud 2read
```{r, fig.width=12,fig.asp=0.5}

Telerobot_sorted %>% select(v,Q_TELEROBOT_IMAGINE_TRANS) %>% drop_na() %>% filter(Q_TELEROBOT_IMAGINE_TRANS != "") %>% count(v)

df <- Telerobot_ages %>% 
  dplyr::filter(v == "IL") %>%
  select("Q_TELEROBOT_IMAGINE_TRANS") %>%
  drop_na() 

  df %>%
  unnest_tokens(word, "Q_TELEROBOT_IMAGINE_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(.*n['’]t)|(robot)", .$word)) %>%
  with(wordcloud(word, n, max.words = 50, scale = c(3.5,.5), colors=brewer.pal(8, "Dark2")))
  #mutate(freq = sprintf("%0.2f%%",n / sum(n) * 100)) %>% arrange(desc(n))


  df %>%
  unnest_tokens(word, "Q_TELEROBOT_IMAGINE_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(.*n['’]t)|(robot)", .$word)) %>%
  with(wordcloud(word, n, max.words = 50, scale = c(5,1), colors=brewer.pal(8, "Dark2")))
  #mutate(freq = sprintf("%0.2f%%",n / sum(n) * 100)) %>% arrange(desc(n))


  df %>%
  unnest_tokens(word, "Q_TELEROBOT_IMAGINE_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(.*n['’]t)|(robot)", .$word)) %>%
  #with(wordcloud(word, n, max.words = 50, scale = c(3.5,.5), colors=brewer.pal(8, "Dark2")))
  mutate(freq = sprintf("%0.2f%%",n / sum(n) * 100)) %>% arrange(desc(n))


  df %>%
  unnest_tokens(word, "Q_TELEROBOT_IMAGINE_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(.*n['’]t)|(robot)", .$word)) %>%
  #with(wordcloud(word, n, max.words = 50, scale = c(5,1), colors=brewer.pal(8, "Dark2")))
  mutate(freq = sprintf("%0.2f%%",n / sum(n) * 100)) %>% arrange(desc(n))



df <- Telerobot_ages %>% 
  dplyr::filter(v == "PS") %>%
  select("Q_TELEROBOT_IMAGINE_TRANS") %>%
  drop_na()


  df %>%
  unnest_tokens(word, "Q_TELEROBOT_IMAGINE_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(.*n['’]t)|(robot)", .$word)) %>%
  #with(wordcloud(word, n, max.words = 50, scale = c(3.5,.5), colors=brewer.pal(8, "Dark2")))
  mutate(freq = sprintf("%0.2f%%",n / sum(n) * 100)) %>% arrange(desc(n))
```


## Word cloud 3
```{r}
Telerobot_sorted %>% 
  select("Q_SHOW_DETAIL_TRANS") %>%
  filter(!grepl("don['’]t", Telerobot_sorted$Q_SHOW_DETAIL_TRANS)) %>%
  unnest_tokens(word, "Q_SHOW_DETAIL_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100, scale = c(25,1), colors=brewer.pal(8, "Dark2")))
```

### Features word cloud
```{r, fig.width=12,fig.asp=0.5}
words_res <- NULL;

for (group in c("IL", "PS")) {
  df <- Telerobot_ages %>% 
  dplyr::filter(v == group) %>%
  select("Q_TELEROBOT_OTHER_TRANS") %>%
  drop_na()

  word_df <-  
   df %>%
  unnest_tokens(word, "Q_TELEROBOT_OTHER_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(.*n['’]t)|(robot)|(ability)", .$word)) 
  
  word_df %>% with(wordcloud(word, n, max.words = 50, scale = c(3.5,.5), colors=brewer.pal(8, "Dark2")))

  
  all_words <- word_df %>% mutate(freq = sprintf("%0.2f%%",n / sum(n) * 100)) %>% arrange(desc(n))
  all_words["v"] = group
  if (is.null(words_res)) {
    words_res <- all_words
  } else {
    words_res <-bind_rows(words_res,all_words)
  }
}

words_res %>% arrange(v,desc(freq))

```

### Features outgroup cloud
```{r, fig.width=12,fig.asp=0.5}
words_res <- NULL;

for (group in c("IL", "PS")) {
  df <- Telerobot_ages %>% 
  dplyr::filter(v == group) %>%
  select("Q_TELEROBOT_OTHER_G_TRANS") %>%
  drop_na()

  word_df <-  
   df %>%
  unnest_tokens(word, "Q_TELEROBOT_OTHER_G_TRANS") %>%
  anti_join(stop_words) %>%
  count(word) %>%
  filter(!grepl("(.*n['’]t)|(robot)|(ability)", .$word)) 
  
 # word_df %>% with(wordcloud(word, n, max.words = 50, scale = c(3.5,.5), colors=brewer.pal(8, "Dark2")))

  all_words <- word_df %>% mutate(freq = sprintf("%0.2f%%",n / sum(n) * 100)) %>% arrange(desc(n))
  all_words["v"] = group
  if (is.null(words_res)) {
    words_res <- all_words
  } else {
    words_res <-bind_rows(words_res,all_words)
  }
}

words_res %>% arrange(v,desc(freq))
```
### Trying wordcloud2
```{r}
  df <- Telerobot_ages %>% 
  dplyr::filter(v == "IL") %>%
  select("Q_TELEROBOT_OTHER_G_TRANS") %>%
  drop_na()


  
  word_df <- df %>%
  unnest_tokens(word, "Q_TELEROBOT_OTHER_G_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(ability)|(people)|(meeting)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.5 )
  
  df <- Telerobot_ages %>% 
  dplyr::filter(v == "PS") %>%
  select("Q_TELEROBOT_OTHER_G_TRANS") %>%
  drop_na()


  
  word_df <- df %>%
  unnest_tokens(word, "Q_TELEROBOT_OTHER_G_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(ability)|(people)|(meeting)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.2 )
  
```
### wordcloud2 features
```{r}
  df <- Telerobot_ages %>% 
  dplyr::filter(v == "IL") %>%
  select("Q_TELEROBOT_OTHER_TRANS") %>%
  drop_na()


  
  word_df <- df %>%
  unnest_tokens(word, "Q_TELEROBOT_OTHER_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(ability)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.5 )
  
  df <- Telerobot_ages %>% 
  dplyr::filter(v == "PS") %>%
  select("Q_TELEROBOT_OTHER_TRANS") %>%
  drop_na()


  
  word_df <- df %>%
  unnest_tokens(word, "Q_TELEROBOT_OTHER_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(ability)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.2 )
  
```


### Wordcloud2: hopes and concerns
```{r}
  df <- Telerobot_ages %>% 
 # dplyr::filter(v == "IL") %>%
  select("Q_GROUP_HOPES_TRANS") %>%
  drop_na()


  word_df <- df %>%
  unnest_tokens(word, "Q_GROUP_HOPES_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(ability)|(people)|(meeting)|(palestinian)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.6 )
  
  df <- Telerobot_ages %>% 
 # dplyr::filter(v == "IL") %>%
  select("Q_GROUP_CONCERNS_TRANS") %>%
  drop_na()


  word_df <- df %>%
  unnest_tokens(word, "Q_GROUP_CONCERNS_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(ability)|(people)|(meeting)|(fears)|(concerns)|(palestinian)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.5 )
  

  
```
# Puppets
```{r}
  df <- Telerobot_ages %>% 
 # dplyr::filter(v == "IL") %>%
  select("Q_PUPPET_IMAGINE_TRANS") %>%
  drop_na()


  word_df <- df %>%
  unnest_tokens(word, "Q_PUPPET_IMAGINE_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(puppet)|(perform.*)|(front)|(people)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.6 )
  
   df <- Telerobot_ages %>% 
 dplyr::filter(v == "IL") %>%
  select("Q_PUPPET_IMAGINE_TRANS") %>%
  drop_na()


  word_df <- df %>%
  unnest_tokens(word, "Q_PUPPET_IMAGINE_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(puppet)|(perform.*)|(front)|(people)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.6 )
  
     df <- Telerobot_ages %>% 
 dplyr::filter(v == "PS") %>%
  select("Q_PUPPET_IMAGINE_TRANS") %>%
  drop_na()


  word_df <- df %>%
  unnest_tokens(word, "Q_PUPPET_IMAGINE_TRANS") %>%
  anti_join(stop_words) %>%
  count(word,sort=TRUE,name = "freq") %>%
  filter(!grepl("(.*n['’]t)|(robot)|(puppet)|(perform.*)|(front)|(people)", .$word))
  
  word_df
  word_df %>% wordcloud2(size = 0.6 )
  
```

